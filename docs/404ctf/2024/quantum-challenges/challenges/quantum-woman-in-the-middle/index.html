<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Le magicien quantique">
<meta name="dcterms.date" content="2024-05-12">

<title>Challenge 2: Quantum Woman-In-The-Middle Attack – Thomas Winninger</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../../assets/favicon.png" rel="icon" type="image/png">
<script src="../../../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-2655609e4c4ce2e7dd4199da68fd4791.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-7f2c800b9ad951581f3d64065e683329.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-2655609e4c4ce2e7dd4199da68fd4791.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap-89d6481253e45a2c139849ed4bb976b2.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/bootstrap/bootstrap-dark-3e2fcb55f1afc831890c2db502db1767.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../../../site_libs/bootstrap/bootstrap-89d6481253e45a2c139849ed4bb976b2.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": true,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../../../styles/styles.css">
<meta property="og:title" content="Challenge 2: Quantum Woman-In-The-Middle Attack – Thomas Winninger">
<meta property="og:description" content="My (Thomas Winninger) personal website.">
<meta property="og:image" content="https://sckathach.github.io/404ctf/2024/quantum-challenges/challenges/quantum-woman-in-the-middle/memes/challenge_2-english.jpg">
<meta property="og:site_name" content="Thomas Winninger">
<meta name="twitter:title" content="Challenge 2: Quantum Woman-In-The-Middle Attack – Thomas Winninger">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://sckathach.github.io/404ctf/2024/quantum-challenges/challenges/quantum-woman-in-the-middle/memes/challenge_2-english.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Thomas Winninger</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../blogs/subspace-rerouting/index.html"> 
<span class="menu-text">SSR</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../research.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../index.html"> 
<span class="menu-text">Writing</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/sckathach" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#before-we-begin" id="toc-before-we-begin" class="nav-link active" data-scroll-target="#before-we-begin"><span class="header-section-number">1</span> Before we begin</a>
  <ul class="collapse">
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="header-section-number">1.1</span> Examples</a></li>
  </ul></li>
  <li><a href="#woman-in-the-middle" id="toc-woman-in-the-middle" class="nav-link" data-scroll-target="#woman-in-the-middle"><span class="header-section-number">2</span> Woman in the middle ?</a></li>
  <li><a href="#bb84-protocol-normal-usage" id="toc-bb84-protocol-normal-usage" class="nav-link" data-scroll-target="#bb84-protocol-normal-usage"><span class="header-section-number">3</span> BB84 Protocol: Normal Usage</a>
  <ul class="collapse">
  <li><a href="#step-1-alice-prepares-her-qubits-to-send" id="toc-step-1-alice-prepares-her-qubits-to-send" class="nav-link" data-scroll-target="#step-1-alice-prepares-her-qubits-to-send"><span class="header-section-number">3.1</span> Step 1: Alice prepares her qubits to send</a></li>
  <li><a href="#step-2-retrieval-by-bob-and-decoding" id="toc-step-2-retrieval-by-bob-and-decoding" class="nav-link" data-scroll-target="#step-2-retrieval-by-bob-and-decoding"><span class="header-section-number">3.2</span> Step 2: Retrieval by Bob and Decoding</a></li>
  <li><a href="#step-3-alice-and-bob-agree." id="toc-step-3-alice-and-bob-agree." class="nav-link" data-scroll-target="#step-3-alice-and-bob-agree."><span class="header-section-number">3.3</span> Step 3: Alice and Bob agree.</a></li>
  <li><a href="#step-4-verification-of-communication-integrity." id="toc-step-4-verification-of-communication-integrity." class="nav-link" data-scroll-target="#step-4-verification-of-communication-integrity."><span class="header-section-number">3.4</span> Step 4: Verification of communication integrity.</a></li>
  </ul></li>
  <li><a href="#protocol-bb84-eve-enters-the-scene" id="toc-protocol-bb84-eve-enters-the-scene" class="nav-link" data-scroll-target="#protocol-bb84-eve-enters-the-scene"><span class="header-section-number">4</span> Protocol BB84: Eve enters the scene</a>
  <ul class="collapse">
  <li><a href="#step-1-re-implement-the-protocol-by-adding-eve-in-the-middle-this-step-is-not-necessary-to-obtain-the-flag-but-recommended-to-facilitate-the-rest" id="toc-step-1-re-implement-the-protocol-by-adding-eve-in-the-middle-this-step-is-not-necessary-to-obtain-the-flag-but-recommended-to-facilitate-the-rest" class="nav-link" data-scroll-target="#step-1-re-implement-the-protocol-by-adding-eve-in-the-middle-this-step-is-not-necessary-to-obtain-the-flag-but-recommended-to-facilitate-the-rest"><span class="header-section-number">4.1</span> Step 1: Re-implement the protocol by adding Eve in the middle <em>(this step is not necessary to obtain the flag, but recommended to facilitate the rest)</em></a></li>
  <li><a href="#step-2-eve-counterattacks-find-a-way-to-bring-down-the-average-error-rate-to-20-or-below." id="toc-step-2-eve-counterattacks-find-a-way-to-bring-down-the-average-error-rate-to-20-or-below." class="nav-link" data-scroll-target="#step-2-eve-counterattacks-find-a-way-to-bring-down-the-average-error-rate-to-20-or-below."><span class="header-section-number">4.2</span> Step 2: Eve counterattacks, find a way to bring down the average error rate to <span class="math inline">\(20\%\)</span> (or below).</a></li>
  </ul></li>
  <li><a href="#flag-recovery" id="toc-flag-recovery" class="nav-link" data-scroll-target="#flag-recovery"><span class="header-section-number">5</span> Flag Recovery</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.dev/Sckathach/Sckathach.github.io/blob/main/404ctf/2024/quantum-challenges/challenges/quantum-woman-in-the-middle/index.ipynb" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/Sckathach/Sckathach.github.io/blob/main/404ctf/2024/quantum-challenges/challenges/quantum-woman-in-the-middle/index.ipynb" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/Sckathach/Sckathach.github.io/issues" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Challenge 2: Quantum Woman-In-The-Middle Attack</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Le magicien quantique </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 12, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div id="initial_id" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> perceval <span class="im">as</span> pcvl</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="before-we-begin" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="before-we-begin"><span class="header-section-number">1</span> Before we begin</h2>
<p>Here are some utilities:</p>
<div id="fcd0864c-b449-4f8d-b81e-6749d8241f1d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> perceval <span class="im">import</span> pdisplay, PS, BS, Circuit, BasicState, Processor, StateVector</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> perceval.backends <span class="im">import</span> BackendFactory</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> perceval.algorithm <span class="im">import</span> Analyzer</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> exqalibur <span class="im">import</span> FockState</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> qiskit.visualization <span class="im">import</span> plot_bloch_multivector</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> qiskit.quantum_info <span class="im">import</span> Statevector</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> pi, cos, sin</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Optional</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's go back to our rail encoding</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>qubits <span class="op">=</span> {</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"0"</span>: BasicState([<span class="dv">1</span>, <span class="dv">0</span>]),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"1"</span>: BasicState([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>qubits_ <span class="op">=</span> {qubits[k]: k <span class="cf">for</span> k <span class="kw">in</span> qubits}</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>sqlist <span class="op">=</span> [qubits[<span class="st">"0"</span>], qubits[<span class="st">"1"</span>]]</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Circuit analysis</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze(circuit: Circuit, input_states: Optional[FockState] <span class="op">=</span> <span class="va">None</span>, output_states: Optional[FockState] <span class="op">=</span> <span class="va">None</span>) <span class="op">\</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> input_states <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        input_states <span class="op">=</span> sqlist</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> output_states <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        output_states <span class="op">=</span> sqlist</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> Processor(<span class="st">"Naive"</span>, circuit)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> Analyzer(p, input_states, output_states, mapping<span class="op">=</span>qubits_)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    pdisplay(a)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Circuit analysis by calculating the amplitudes</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> amplitudes(circuit: Circuit, input_state: Optional[FockState] <span class="op">=</span> <span class="va">None</span>, output_states: Optional[FockState] <span class="op">=</span> <span class="va">None</span>) <span class="op">\</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">-&gt;</span> (<span class="bu">complex</span>, <span class="bu">complex</span>):</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> input_state <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        input_state <span class="op">=</span> qubits[<span class="st">"0"</span>]</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> output_states <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>        output_states <span class="op">=</span> sqlist</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> BackendFactory.get_backend(<span class="st">"Naive"</span>)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    b.set_circuit(circuit)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    b.set_input_state(input_state)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {qubits_[k]: roundc(b.prob_amplitude(k)) <span class="cf">for</span> k <span class="kw">in</span> output_states}</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Display of the Bloch sphere</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> circuit_to_state_vector(circuit: Circuit) <span class="op">-&gt;</span> Statevector:</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    ampl0, ampl1 <span class="op">=</span> amplitudes(circuit)</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Statevector([ampl0, ampl1])</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>plot_bloch <span class="op">=</span> <span class="kw">lambda</span> circuit : plot_bloch_multivector(circuit_to_state_vector(circuit))</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotations</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>x_rot <span class="op">=</span> <span class="kw">lambda</span> x: Circuit(<span class="dv">2</span>) <span class="op">//</span> (<span class="dv">0</span>, PS(pi)) <span class="op">//</span> BS.Rx(theta<span class="op">=</span>x) <span class="op">//</span> (<span class="dv">0</span>, PS(pi)) </span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>y_rot <span class="op">=</span> <span class="kw">lambda</span> x: BS.Ry(theta<span class="op">=</span>x)</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>z_rot <span class="op">=</span> <span class="kw">lambda</span> x: BS.H() <span class="op">//</span> x_rot(x) <span class="op">//</span> BS.H() </span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Trigonometry with Matplotlib</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_trig(angles, colors<span class="op">=</span><span class="va">None</span>, annotations<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> <span class="fl">1.5</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> colors <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        colors <span class="op">=</span> [<span class="st">"blue"</span>] <span class="op">*</span> <span class="bu">len</span>(angles)</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> annotations <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>        annotations <span class="op">=</span> [<span class="st">""</span>] <span class="op">*</span> <span class="bu">len</span>(angles)</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> angle, color, annotation <span class="kw">in</span> <span class="bu">zip</span>(angles, colors, annotations):</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>        pos_x <span class="op">=</span> r <span class="op">*</span> cos(angle)</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>        pos_y <span class="op">=</span> r <span class="op">*</span> sin(angle)</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>        plt.plot([<span class="dv">0</span>, pos_x], [<span class="dv">0</span>, pos_y], color<span class="op">=</span>color)</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        pos_x_a <span class="op">=</span> pos_x <span class="op">+</span> np.sign(pos_x) <span class="op">*</span> <span class="fl">0.1</span> <span class="op">-</span> (<span class="fl">0.05</span> <span class="op">*</span> <span class="bu">len</span>(annotation) <span class="cf">if</span> np.sign(pos_x) <span class="op">&lt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>        pos_y_a <span class="op">=</span> pos_y <span class="op">+</span> np.sign(pos_y) <span class="op">*</span> <span class="fl">0.1</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>        plt.gca().annotate(annotation, xy<span class="op">=</span>(pos_x_a, pos_y_a), xycoords<span class="op">=</span><span class="st">'data'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>    plt.plot(<span class="dv">0</span>, <span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.linspace(<span class="dv">0</span> <span class="op">*</span> pi, <span class="dv">2</span> <span class="op">*</span> pi, <span class="dv">100</span>)</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>    xs, ys <span class="op">=</span> r <span class="op">*</span> cos(a), r <span class="op">*</span> sin(a)</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    plt.plot(xs, ys, color<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>    plt.xlim(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>    plt.ylim(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>    plt.gca().set_aspect(<span class="st">'equal'</span>)</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Version of `round()` for complex numbers</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> roundc(c: <span class="bu">complex</span>, decimals: <span class="bu">int</span> <span class="op">=</span> <span class="dv">2</span>) <span class="op">-&gt;</span> <span class="bu">complex</span>:</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">round</span>(c.real, decimals) <span class="op">+</span> <span class="bu">round</span>(c.imag, decimals) <span class="op">*</span> <span class="ot">1j</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="examples" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="examples"><span class="header-section-number">1.1</span> Examples</h3>
<div id="719ee610-4df9-40ce-9293-acf55ad256f7" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>hadamard_gate <span class="op">=</span> BS.H()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(amplitudes(hadamard_gate))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>analyze(hadamard_gate)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>plot_bloch(hadamard_gate)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Not only the Bloch sphere can be used to represent qubits, we can simply use a trigonometric circle. The transition is explicit: <strong>the abscissa corresponds to <span class="math inline">\(|0\rangle\)</span> and the ordinate to <span class="math inline">\(|1\rangle\)</span></strong>, so <span class="math inline">\(|+\rangle\)</span> is at <span class="math inline">\(\frac{\pi}{4}\)</span>. All states are on the circle, as the sum of probabilities, which here is an amplitude, is always <span class="math inline">\(1\)</span>. However, with this display, we lose information about the global phase.</p>
<p>For example, here are the canonical basis (in blue) and the Hadamard basis (in red):</p>
<div id="5b10e24f-e65a-431e-914a-6b2524ecc8a4" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>plot_trig([<span class="dv">0</span>, pi<span class="op">/</span><span class="dv">2</span>, pi<span class="op">/</span><span class="dv">4</span>, <span class="op">-</span>pi<span class="op">/</span><span class="dv">4</span>], [<span class="st">"blue"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"red"</span>], [<span class="st">"|0&gt;"</span>, <span class="st">"|1&gt;"</span>, <span class="st">"|+&gt;"</span>, <span class="st">"|-&gt;"</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>For this challenge, as we don’t need phase but want to visualize multiple bases at the same time, we will use only the representation with the trigonometric circle.</p>
</section>
</section>
<section id="woman-in-the-middle" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="woman-in-the-middle"><span class="header-section-number">2</span> Woman in the middle ?</h2>
<p>You all know the classic Man-In-The-Middle attack, where an attacker intercepts communication between two entities who are unaware that their conversation is being eavesdropped. Today, I propose you to discover the <strong>quantum version!</strong> <strong>Alice</strong> and <strong>Bob</strong> (yes, them again, even physicists are fans) decide to exchange a secret key using the <strong>BB84 protocol</strong>. Being confident in the reliability of their protocol, they tolerate some noise. However, <strong>Eve</strong> manages to intercept the communication channel. Will she succeed in going unnoticed?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="memes/challenge_2-english.jpg" class="img-fluid figure-img"></p>
<figcaption>table_cat_meme.jpg</figcaption>
</figure>
</div>
</section>
<section id="bb84-protocol-normal-usage" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="bb84-protocol-normal-usage"><span class="header-section-number">3</span> BB84 Protocol: Normal Usage</h2>
<p>The BB84 protocol allows the exchange of a key of <span class="math inline">\(n\)</span> bits with <span class="math inline">\(4n\)</span> qubits. It is based on the principle that if someone were to eavesdrop on the conversation, that person would be forced to <strong>measure</strong> the qubits, thus collapsing the associated wave functions (a measurement is a projection and thus a loss of information). <strong>This collapse is thus visible</strong>, introducing a <span class="math inline">\(25\%\)</span> error rate during the verification step.</p>
<section id="step-1-alice-prepares-her-qubits-to-send" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="step-1-alice-prepares-her-qubits-to-send"><span class="header-section-number">3.1</span> Step 1: Alice prepares her qubits to send</h3>
<p><strong>1.a)</strong> First, a key is needed, for which a random binary string of size <span class="math inline">\(4n\)</span> is generated.</p>
<p><em>It is possible to generate this string using a quantum computer for better quality randomness.</em></p>
<div id="790d1fbb-389d-4b59-be10-65b5ea092da5" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>bits_alice <span class="op">=</span> np.random.randint(low<span class="op">=</span><span class="dv">0</span>, high<span class="op">=</span><span class="dv">2</span>, size<span class="op">=</span>(<span class="dv">4</span> <span class="op">*</span> N,))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>1.b)</strong> Alice will then choose <span class="math inline">\(4n\)</span> random bases from <span class="math inline">\({+, \times}\)</span>, in which she will encode her qubits. <em>(Please excuse the confusion between the <span class="math inline">\(+\)</span> basis and the <span class="math inline">\(|+\rangle\)</span> state, which are not related; I am following the same conventions as the literature)</em>.</p>
<p>The + basis is the canonical basis:</p>
<p><span class="math display">\[
+ = \left\{ \begin{pmatrix} 1 \\ 0 \end{pmatrix}, \begin{pmatrix} 0 \\ 1 \end{pmatrix}\right\}
\]</span></p>
<p>While the × basis is defined by:</p>
<p><span class="math display">\[
\times = \left\{\frac{1}{\sqrt{2}}\begin{pmatrix} 1 \\ 1 \end{pmatrix}, \frac{1}{\sqrt{2}}\begin{pmatrix} -1 \\ 1 \end{pmatrix}\right\}
\]</span></p>
<p>We can visualize them:</p>
<div id="cc8ff088-9aac-4987-b0dd-9afcf4563d55" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>plot_trig([<span class="dv">0</span>, pi<span class="op">/</span><span class="dv">2</span>, pi<span class="op">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="op">*</span>pi<span class="op">/</span><span class="dv">4</span>], [<span class="st">"blue"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"red"</span>], [<span class="st">"0 (+)"</span>, <span class="st">"1 (+)"</span>, <span class="st">"0 (x)"</span>, <span class="st">"1 (x)"</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The encoding is fully represented in this diagram: <span class="math inline">\(1\)</span> in the <span class="math inline">\(\times\)</span> basis will be encoded as: <span class="math display">\[
-\frac{\sqrt{2}}{2} \begin{pmatrix} 1 \\ 0 \end{pmatrix} + \frac{\sqrt{2}}{2} \begin{pmatrix} 0 \\ 1 \end{pmatrix} =  -\frac{1}{\sqrt{2}} |0\rangle + \frac{1}{\sqrt{2}} |1\rangle
\]</span></p>
<p><em>As a reminder, with the rail encoding we saw earlier, this becomes:</em> <span class="math display">\[
-\frac{1}{\sqrt{2}} |1, 0\rangle\rangle + \frac{1}{\sqrt{2}} |0, 1\rangle\rangle
\]</span> <em>We use this notation for Fock states (the rails), to avoid confusion with the multi-state <span class="math inline">\(|10\rangle\)</span> that we will discover later.</em></p>
<p><em>No matter what name we give to our basis vectors, here the canonical one, it obviously doesn’t change the calculations. I haven’t specified it, but (almost) everything done in the context of this competition is reproducible on quantum computers with different technologies. You just need to adapt the qubit encoding, the calculations remain the same.</em></p>
<div id="a7777d13-edb4-4356-ac2f-366b80687f8b" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>bases_alice <span class="op">=</span> np.array([<span class="st">"+"</span> <span class="cf">if</span> b <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">"x"</span> <span class="cf">for</span> b <span class="kw">in</span> np.random.randint(low<span class="op">=</span><span class="dv">0</span>, high<span class="op">=</span><span class="dv">2</span>, size<span class="op">=</span>(<span class="dv">4</span> <span class="op">*</span> N,))])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>1.c)</strong> Alice can now encode her <span class="math inline">\(4n\)</span> qubits in her <span class="math inline">\(4n\)</span> bases. <em>I use <code>StateVector</code>, which is a generalization of <code>BasicState</code> we encountered. This allows me to perform operations on the states more easily, without worrying about normalization, which is done automatically.</em></p>
<p><strong><em>&gt;&gt; Be careful with <code>StateVector</code>s, they can be tricky, <code>3 * a + b</code> works, while <code>a + 3 * b</code> does not!</em></strong> <em>Also, beware of confusion between Qiskit’s <code>Statevector</code> and Perceval’s <code>StateVector</code>, we use both…</em></p>
<div id="a0983c22-6573-43c4-b681-4baeeb301c23" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>qubits_alice <span class="op">=</span> []</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># To test more easily, I define the values of 0 and 1 in the X basis, be careful, these are no longer </span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># BasicState, but StateVector, so you need to use the measure function (see below) to manipulate them</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>qubits[<span class="st">"0x"</span>] <span class="op">=</span> qubits[<span class="st">"0"</span>] <span class="op">+</span> qubits[<span class="st">"1"</span>] </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>qubits[<span class="st">"1x"</span>] <span class="op">=</span> qubits[<span class="st">"1"</span>] <span class="op">-</span> qubits[<span class="st">"0"</span>] </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(qubits[<span class="st">"0"</span>]), <span class="bu">type</span>(qubits[<span class="st">"0x"</span>]))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bit, basis  <span class="kw">in</span> <span class="bu">zip</span>(bits_alice, bases_alice):</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> basis <span class="op">==</span> <span class="st">"+"</span>:</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> pcvl.StateVector(qubits[<span class="st">"0"</span>]) <span class="cf">if</span> bit <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> pcvl.StateVector(qubits[<span class="st">"1"</span>])</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> qubits[<span class="st">"0x"</span>] <span class="cf">if</span> bit <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> qubits[<span class="st">"1x"</span>]</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    qubits_alice.append(s)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Displaying the first 9 to verify:</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(qubits_alice) <span class="op">&lt;</span> <span class="dv">10</span>: </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Bit à encoder : </span><span class="sc">{</span>bit<span class="sc">}</span><span class="ss">, base choisie : </span><span class="sc">{</span>basis<span class="sc">}</span><span class="ss">, qubit correspondant : </span><span class="sc">{</span>s<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now that Alice has prepared her qubits, she can send them to Bob. <em>For example, using a photon.</em></p>
</section>
<section id="step-2-retrieval-by-bob-and-decoding" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="step-2-retrieval-by-bob-and-decoding"><span class="header-section-number">3.2</span> Step 2: Retrieval by Bob and Decoding</h3>
<p>Bob <strong>does not know the bases in which the qubits were encoded</strong>, so he will randomly choose <span class="math inline">\(4n\)</span> bases like Alice, and will measure Alice’s qubits. Only half of the bits will be correct, as he has a fifty-fifty chance each time of choosing the same basis as Alice.</p>
<p>Once he has measured the photons, they have collapsed, and no one can have them anymore. This is an important concept to understand. In the classical world, we can send a message while keeping a version of its content on our side; it’s not as if every message we send is erased from our phone and memory. In the quantum world, however, this is the case! There is even a dedicated theorem: the <strong>no-cloning theorem.</strong> We cannot take an arbitrary unknown quantum state and have a device that returns two copies of that state. This is obviously very practical in the cyber world. We can take actions after measurement with guarantees.</p>
<p><strong>2.a)</strong> Bob randomly chooses <span class="math inline">\(4n\)</span> bases:</p>
<div id="d267b387-433d-4856-99a9-a3ec2400a1b7" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>bases_bob <span class="op">=</span> np.array([<span class="st">"+"</span> <span class="cf">if</span> b <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">"x"</span> <span class="cf">for</span> b <span class="kw">in</span> np.random.randint(low<span class="op">=</span><span class="dv">0</span>, high<span class="op">=</span><span class="dv">2</span>, size<span class="op">=</span>(<span class="dv">4</span><span class="op">*</span>N,))])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>To simulate a measurement, we will use the “SLOS” processor:</p>
<div id="888492bd-b203-474e-b4bc-d88bd5b6577c" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> measure(input_state, circuit, full<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> pcvl.Processor(<span class="st">"SLOS"</span>, circuit)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    p.with_input(input_state)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    sampler <span class="op">=</span> pcvl.algorithm.Sampler(p)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Complete measurement made with 1000 attempts, so we end up with a result similar to the Analyzer.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> full:</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        sample_count <span class="op">=</span> sampler.sample_count(<span class="dv">1000</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sample_count[<span class="st">'results'</span>]</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    sample_count <span class="op">=</span> sampler.sample_count(<span class="dv">1</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">list</span>(sample_count[<span class="st">'results'</span>].keys())[<span class="dv">0</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>2.b)</strong> Bob prepares the circuits necessary for these measurements.</p>
<p>To measure in the <span class="math inline">\(+\)</span> basis, it is sufficient to take the identity since it is our canonical basis:</p>
<div id="5aef301b-f117-4f16-b9e9-73a5083dddce" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>base_p <span class="op">=</span> Circuit(<span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>One can verify:</p>
<div id="fe655c22-ac48-41ee-a450-65e9b918db25" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"""</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ss">0 in the + base: </span><span class="sc">{</span>measure(qubits[<span class="st">"0"</span>], base_p, full<span class="op">=</span><span class="va">True</span>)<span class="sc">}</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="ss">1 in the + base: </span><span class="sc">{</span>measure(qubits[<span class="st">"1"</span>], base_p, full<span class="op">=</span><span class="va">True</span>)<span class="sc">}</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="ss">0 in the x base (</span><span class="sc">{</span>qubits[<span class="st">"0x"</span>]<span class="sc">}</span><span class="ss">) measured in the + base: </span><span class="sc">{</span>measure(qubits[<span class="st">"0x"</span>], base_p, full<span class="op">=</span><span class="va">True</span>)<span class="sc">}</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ss">1 in the x base (</span><span class="sc">{</span>qubits[<span class="st">"1x"</span>]<span class="sc">}</span><span class="ss">) measured in the + base: </span><span class="sc">{</span>measure(qubits[<span class="st">"1x"</span>], base_p, full<span class="op">=</span><span class="va">True</span>)<span class="sc">}</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>As expected, there’s no way to determine Alice’s bit if Bob chooses the wrong base. We do the same for the x base. This time, we use a rotation of <span class="math inline">\(-\frac{\pi}{4}\)</span> (transition from the x base to our canonical base). I use a rotation <span class="math inline">\(y\)</span> with an angle of <span class="math inline">\(-\frac{\pi}{2}\)</span> for this, due to differences in conventions between the Bloch sphere and our trigonometric circle.</p>
<div id="34df1fad-ae2b-4c86-a346-043df65864be" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>base_x <span class="op">=</span> y_rot(<span class="op">-</span>pi<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"""</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="ss">0 in the x base: </span><span class="sc">{</span>measure(qubits[<span class="st">"0x"</span>], base_x, full<span class="op">=</span><span class="va">True</span>)<span class="sc">}</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="ss">1 in the x base: </span><span class="sc">{</span>measure(qubits[<span class="st">"1x"</span>], base_x, full<span class="op">=</span><span class="va">True</span>)<span class="sc">}</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="ss">0 in the + base (</span><span class="sc">{</span>qubits[<span class="st">"0"</span>]<span class="sc">}</span><span class="ss">) measured in the x base: </span><span class="sc">{</span>measure(qubits[<span class="st">"0"</span>], base_x, full<span class="op">=</span><span class="va">True</span>)<span class="sc">}</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="ss">1 in the + base (</span><span class="sc">{</span>qubits[<span class="st">"1"</span>]<span class="sc">}</span><span class="ss">) measured in the x base: </span><span class="sc">{</span>measure(qubits[<span class="st">"1"</span>], base_x, full<span class="op">=</span><span class="va">True</span>)<span class="sc">}</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>2.c)</strong> Bob measures the qubits sent by Alice in his bases.</p>
<div id="e2d788e3c72857b1" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;outputs_hidden&quot;:false}}">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>bits_bob <span class="op">=</span> []</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> q, b <span class="kw">in</span> <span class="bu">zip</span>(qubits_alice, bases_bob): </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> b <span class="op">==</span> <span class="st">"+"</span>:</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        bits_bob.append(<span class="dv">0</span> <span class="cf">if</span> measure(q, base_p) <span class="op">==</span> qubits[<span class="st">"0"</span>] <span class="cf">else</span> <span class="dv">1</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        bits_bob.append(<span class="dv">0</span> <span class="cf">if</span> measure(q, base_x) <span class="op">==</span> qubits[<span class="st">"0"</span>] <span class="cf">else</span> <span class="dv">1</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>bits_bob <span class="op">=</span> np.array(bits_bob)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>On peut calculer la correspondance avec la clef d’Alice :</p>
<div id="5b2fd853543a310c" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;outputs_hidden&quot;:false}}">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>correspondance_secret_key_bits_bob <span class="op">=</span> bits_bob <span class="op">==</span> bits_alice</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">sum</span>(correspondance_secret_key_bits_bob) <span class="op">/</span> (<span class="dv">4</span> <span class="op">*</span> N)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>We have approximately <span class="math inline">\(\sim 75%\)</span> equivalence: in <span class="math inline">\(50%\)</span> of the cases, Alice and Bob have the same basis, hence the same values. There is an additional <span class="math inline">\(25%\)</span> because when they do not have the same basis, there is a <span class="math inline">\(50%\)</span> success rate.</p>
</section>
<section id="step-3-alice-and-bob-agree." class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="step-3-alice-and-bob-agree."><span class="header-section-number">3.3</span> Step 3: Alice and Bob agree.</h3>
<p>Once the qubits have been measured by Bob, Bob will <strong>make his bases public</strong>, and Alice will then tell him where there is a match, and therefore where they can be sure to have the same values.</p>
<div id="2f9d02c40f9e63e2" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;outputs_hidden&quot;:false}}">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>correspondance_bases_alice_bob <span class="op">=</span> bases_bob <span class="op">==</span> bases_alice </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>half_bits_bob <span class="op">=</span> bits_bob[correspondance_bases_alice_bob]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>half_bits_alice <span class="op">=</span> bits_alice[correspondance_bases_alice_bob]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">CAUTION</span><span class="co">: Do not rerun this cell alone; rerun the entire notebook to refresh this cell correctly.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="step-4-verification-of-communication-integrity." class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="step-4-verification-of-communication-integrity."><span class="header-section-number">3.4</span> Step 4: Verification of communication integrity.</h3>
<p>To verify that there has been no eavesdropping, Alice and Bob will <strong>make half of their common key public</strong>. If there is a total match, then we are sure that no one has eavesdropped.</p>
<div id="15de07ce-9159-4bd7-8752-ccbbd9dd3f72" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>last_slice <span class="op">=</span> <span class="bu">len</span>(half_bits_bob) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>verification <span class="op">=</span> half_bits_bob[:last_slice] <span class="op">==</span> half_bits_alice[:last_slice]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Match percentage: </span><span class="sc">{</span><span class="bu">int</span>(np.<span class="bu">sum</span>(verification) <span class="op">/</span> last_slice <span class="op">*</span> <span class="dv">100</span>)<span class="sc">}</span><span class="ss">%"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Hence, <em>in fine</em>, the secret key has a length approximately equal to <span class="math inline">\(n\)</span> (One can find an <span class="math inline">\(n'\)</span> such that the probability of having <span class="math inline">\(|key| &gt; n\)</span> is arbitrarily large, then cut it to <span class="math inline">\(n\)</span>):</p>
<div id="5e272b07c520896" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;outputs_hidden&quot;:false}}">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>secret_key <span class="op">=</span> half_bits_bob[last_slice:]</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Secret key: </span><span class="sc">{</span>secret_key<span class="sc">}</span><span class="ss">, length: </span><span class="sc">{</span><span class="bu">len</span>(secret_key)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="protocol-bb84-eve-enters-the-scene" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="protocol-bb84-eve-enters-the-scene"><span class="header-section-number">4</span> Protocol BB84: Eve enters the scene</h2>
<p>Everything is identical, except now Eve intercepts the communication and tries to deduce part of the exchanged key.</p>
<section id="step-1-re-implement-the-protocol-by-adding-eve-in-the-middle-this-step-is-not-necessary-to-obtain-the-flag-but-recommended-to-facilitate-the-rest" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="step-1-re-implement-the-protocol-by-adding-eve-in-the-middle-this-step-is-not-necessary-to-obtain-the-flag-but-recommended-to-facilitate-the-rest"><span class="header-section-number">4.1</span> Step 1: Re-implement the protocol by adding Eve in the middle <em>(this step is not necessary to obtain the flag, but recommended to facilitate the rest)</em></h3>
<p>Eve first uses the same strategy as Bob and Alice. She pretends to be Bob and then Alice, performing the same encoding/decoding actions.</p>
<div id="39bc542994318f51" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;outputs_hidden&quot;:false}}">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Alice prepares her qubits.</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>bits_alice <span class="op">=</span> np.random.randint(low<span class="op">=</span><span class="dv">0</span>, high<span class="op">=</span><span class="dv">2</span>, size<span class="op">=</span>(<span class="dv">4</span> <span class="op">*</span> N,))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>bases_alice <span class="op">=</span> np.array([<span class="st">"+"</span> <span class="cf">if</span> b <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">"x"</span> <span class="cf">for</span> b <span class="kw">in</span> np.random.randint(low<span class="op">=</span><span class="dv">0</span>, high<span class="op">=</span><span class="dv">2</span>, size<span class="op">=</span>(<span class="dv">4</span> <span class="op">*</span> N,))])</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>qubits_alice <span class="op">=</span> []</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bit, basis  <span class="kw">in</span> <span class="bu">zip</span>(bits_alice, bases_alice):</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> basis <span class="op">==</span> <span class="st">"+"</span>:</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> pcvl.StateVector(qubits[<span class="st">"0"</span>]) <span class="cf">if</span> bit <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> pcvl.StateVector(qubits[<span class="st">"1"</span>])</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> qubits[<span class="st">"0x"</span>] <span class="cf">if</span> bit <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> qubits[<span class="st">"1x"</span>]</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    qubits_alice.append(s)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Eve intercepts them and applies the same method as Bob, pretending to be him. </span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>bits_eve <span class="op">=</span> []</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="cf">raise</span> <span class="pp">NotImplementedError</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>bits_eve <span class="op">=</span> np.array(bits_eve)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co"># She then sends the corresponding qubits to pretend to be Alice. </span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>qubits_eve <span class="op">=</span> []</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="cf">raise</span> <span class="pp">NotImplementedError</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Bob receives the qubits from Eve and applies the same methods as before. </span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>bases_bob <span class="op">=</span> np.array([<span class="st">"+"</span> <span class="cf">if</span> b <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">"x"</span> <span class="cf">for</span> b <span class="kw">in</span> np.random.randint(low<span class="op">=</span><span class="dv">0</span>, high<span class="op">=</span><span class="dv">2</span>, size<span class="op">=</span>(<span class="dv">4</span> <span class="op">*</span> N,))])</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>bits_bob <span class="op">=</span> []</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> q, b <span class="kw">in</span> <span class="bu">zip</span>(qubits_eve, bases_bob):</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> b <span class="op">==</span> <span class="st">"+"</span>:</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>        bits_bob.append(<span class="dv">0</span> <span class="cf">if</span> measure(q, base_p) <span class="op">==</span> qubits[<span class="st">"0"</span>] <span class="cf">else</span> <span class="dv">1</span>)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>        bits_bob.append(<span class="dv">0</span> <span class="cf">if</span> measure(q, base_x) <span class="op">==</span> qubits[<span class="st">"0"</span>] <span class="cf">else</span> <span class="dv">1</span>)</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>bits_bob <span class="op">=</span> np.array(bits_bob)</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Final step: sharing the results. </span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>correspondance_bases_alice_bob <span class="op">=</span> bases_bob <span class="op">==</span> bases_alice</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>half_bits_alice <span class="op">=</span> bits_alice[correspondance_bases_alice_bob]</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>half_bits_bob <span class="op">=</span> bits_bob[correspondance_bases_alice_bob]</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>last_slice <span class="op">=</span> <span class="bu">len</span>(half_bits_alice) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification of proper execution. </span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>verification <span class="op">=</span> half_bits_alice[:last_slice] <span class="op">==</span> half_bits_bob[:last_slice]</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>correspondance_percentage <span class="op">=</span> <span class="bu">int</span>(np.<span class="bu">sum</span>(verification) <span class="op">/</span> last_slice <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Match percentage: </span><span class="sc">{</span>correspondance_percentage<span class="sc">}</span><span class="ss">%, error of: </span><span class="sc">{</span><span class="dv">100</span> <span class="op">-</span> correspondance_percentage<span class="sc">}</span><span class="ss">%."</span>)</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>secret_key_step_1 <span class="op">=</span> half_bits_bob[:last_slice]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>By performing the calculations, it is shown that the error rate averages <span class="math inline">\(25\%\)</span>. By exchanging a large number of bits, we approach this average, thereby detecting eavesdropping.</p>
<div id="43fe14ffe2d88764" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;outputs_hidden&quot;:false}}">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(secret_key_step_1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>It’s not exactly the key yet; error correction codes will still be needed for Alice and Bob to end up with the same key. For the purposes of this challenge, we will stop here.</p>
<p>In this case, Eve gets detected. However, it’s possible to reduce the error, albeit slightly, to make it appear as noise. Let’s simplify by assuming that an error rate below <span class="math inline">\(20\%\)</span> is considered as noise.</p>
</section>
<section id="step-2-eve-counterattacks-find-a-way-to-bring-down-the-average-error-rate-to-20-or-below." class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="step-2-eve-counterattacks-find-a-way-to-bring-down-the-average-error-rate-to-20-or-below."><span class="header-section-number">4.2</span> Step 2: Eve counterattacks, find a way to bring down the average error rate to <span class="math inline">\(20\%\)</span> (or below).</h3>
<p>The protocol remains the same; the only adjustable parameters are the measurement bases to measure Alice’s qubits and the qubits to send to Bob. The matching percentage should be above <span class="math inline">\(79\)</span> for <span class="math inline">\(N = 5000\)</span> to pass the tests.</p>
<div id="c1354aa7d6187475" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;outputs_hidden&quot;:false}}">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Alice prepares her qubits.</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>bits_alice <span class="op">=</span> np.random.randint(low<span class="op">=</span><span class="dv">0</span>, high<span class="op">=</span><span class="dv">2</span>, size<span class="op">=</span>(<span class="dv">4</span> <span class="op">*</span> N,))</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>bases_alice <span class="op">=</span> np.array([<span class="st">"+"</span> <span class="cf">if</span> b <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">"x"</span> <span class="cf">for</span> b <span class="kw">in</span> np.random.randint(low<span class="op">=</span><span class="dv">0</span>, high<span class="op">=</span><span class="dv">2</span>, size<span class="op">=</span>(<span class="dv">4</span> <span class="op">*</span> N,))])</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>qubits_alice <span class="op">=</span> []</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bit, basis  <span class="kw">in</span> <span class="bu">zip</span>(bits_alice, bases_alice):</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> basis <span class="op">==</span> <span class="st">"+"</span>:</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> pcvl.StateVector(qubits[<span class="st">"0"</span>]) <span class="cf">if</span> bit <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> pcvl.StateVector(qubits[<span class="st">"1"</span>])</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> qubits[<span class="st">"0x"</span>] <span class="cf">if</span> bit <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> qubits[<span class="st">"1x"</span>]</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    qubits_alice.append(s)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Intercepting...</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>bits_eve <span class="op">=</span> ...</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="cf">raise</span> <span class="pp">NotImplementedError</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Sending...</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>qubits_eve <span class="op">=</span> []</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="cf">raise</span> <span class="pp">NotImplementedError</span> </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Bob receives the qubits from Eve and applies the same methods as before. </span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>bases_bob <span class="op">=</span> np.array([<span class="st">"+"</span> <span class="cf">if</span> b <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">"x"</span> <span class="cf">for</span> b <span class="kw">in</span> np.random.randint(low<span class="op">=</span><span class="dv">0</span>, high<span class="op">=</span><span class="dv">2</span>, size<span class="op">=</span>(<span class="dv">4</span> <span class="op">*</span> N,))])</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>bits_bob <span class="op">=</span> []</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> q, b <span class="kw">in</span> <span class="bu">zip</span>(qubits_eve, bases_bob):</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> b <span class="op">==</span> <span class="st">"+"</span>:</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>        bits_bob.append(<span class="dv">0</span> <span class="cf">if</span> measure(q, base_p) <span class="op">==</span> qubits[<span class="st">"0"</span>] <span class="cf">else</span> <span class="dv">1</span>)</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>        bits_bob.append(<span class="dv">0</span> <span class="cf">if</span> measure(q, base_x) <span class="op">==</span> qubits[<span class="st">"0"</span>] <span class="cf">else</span> <span class="dv">1</span>)</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>bits_bob <span class="op">=</span> np.array(bits_bob)</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Final step: sharing the results. </span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>correspondance_bases_alice_bob <span class="op">=</span> bases_bob <span class="op">==</span> bases_alice</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>half_bits_alice <span class="op">=</span> bits_alice[correspondance_bases_alice_bob]</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>half_bits_bob <span class="op">=</span> bits_bob[correspondance_bases_alice_bob]</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>last_slice <span class="op">=</span> <span class="bu">len</span>(half_bits_alice) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification of proper execution. </span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>verification <span class="op">=</span> half_bits_alice[:last_slice] <span class="op">==</span> half_bits_bob[:last_slice]</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>correspondance_percentage <span class="op">=</span> <span class="bu">int</span>(np.<span class="bu">sum</span>(verification) <span class="op">/</span> last_slice <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Match percentage: </span><span class="sc">{</span>correspondance_percentage<span class="sc">}</span><span class="ss">%, error of: </span><span class="sc">{</span><span class="dv">100</span> <span class="op">-</span> correspondance_percentage<span class="sc">}</span><span class="ss">%."</span>)</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>secret_key_step_2 <span class="op">=</span> half_bits_bob[:last_slice]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="flag-recovery" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="flag-recovery"><span class="header-section-number">5</span> Flag Recovery</h2>
<p>The day I manage to get <code>pcvl.random_seed(66)</code> to work, I will ask you for the keys. In the meantime, I would like the two bases used in step 2, as well as the two types of qubits sent by Eve.</p>
<p><em>Feel free to DM me if you encounter any issues (sckathach on Discord).</em></p>
<div id="446ba3c812bf5057" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;outputs_hidden&quot;:false}}">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> circuit_to_list(circuit: Circuit) <span class="op">-&gt;</span> List[List[Tuple[<span class="bu">float</span>, <span class="bu">float</span>]]]:</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [[(x.real, x.imag) <span class="cf">for</span> x <span class="kw">in</span> l] <span class="cf">for</span> l <span class="kw">in</span> np.array(circuit.compute_unitary())]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> state_vector_to_list(sv: StateVector) <span class="op">-&gt;</span> List[Tuple[<span class="bu">float</span>, <span class="bu">float</span>]]:</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(sv) <span class="kw">is</span> <span class="kw">not</span> StateVector:</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        sv <span class="op">=</span> pcvl.StateVector(sv)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    sv.normalize()</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> [(<span class="fl">0.</span>, <span class="fl">0.</span>), (<span class="fl">0.</span>, <span class="fl">0.</span>)]</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k, v <span class="kw">in</span> sv:</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        r[<span class="bu">int</span>(qubits_[k])] <span class="op">=</span> (v.real, v.imag)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> list_to_state_vector(p: List[Tuple[<span class="bu">float</span>, <span class="bu">float</span>]]) <span class="op">-&gt;</span> StateVector:</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">complex</span>(p[<span class="dv">0</span>][<span class="dv">0</span>], p[<span class="dv">0</span>][<span class="dv">1</span>]) <span class="op">*</span> StateVector([<span class="dv">1</span>, <span class="dv">0</span>]) <span class="op">+</span> <span class="bu">complex</span>(p[<span class="dv">1</span>][<span class="dv">0</span>], p[<span class="dv">1</span>][<span class="dv">1</span>]) <span class="op">*</span> StateVector([<span class="dv">0</span>, <span class="dv">1</span>]) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="17e4920685b492a8" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;outputs_hidden&quot;:false}}">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example with the protocol of step one: </span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># example_base_eve_1 = base_p </span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># example_base_eve_2 = base_x</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># example_qubit_eve_1 = qubits["0"]</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># example_qubit_eve_2 = qubits["1"]</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># example_qubit_eve_3 = qubits["0x"]</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># example_qubit_eve_4 = qubits["1x"]</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> {</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"base_eve_1"</span>: circuit_to_list(...),</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"base_eve_2"</span>: circuit_to_list(...),</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"qubit_eve_1"</span>: state_vector_to_list(...),</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"qubit_eve_2"</span>: state_vector_to_list(...),</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"qubit_eve_3"</span>: state_vector_to_list(...),</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"qubit_eve_4"</span>: state_vector_to_list(...)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="cf">raise</span> <span class="pp">NotImplementedError</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="936fd60ce121b3ac" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;outputs_hidden&quot;:false}}">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests <span class="im">as</span> rq</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>URL <span class="op">=</span> ...</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># URL = "https://perceval.challenges.404ctf.fr"</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>rq.get(URL <span class="op">+</span> <span class="st">"/healthcheck"</span>).json()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="e7dd3ad532bdc49" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;jupyter&quot;,&quot;value&quot;:{&quot;outputs_hidden&quot;:false}}">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>rq.post(URL <span class="op">+</span> <span class="st">"/challenges/2"</span>, json<span class="op">=</span>d).json()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/sckathach\.github\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.dev/Sckathach/Sckathach.github.io/blob/main/404ctf/2024/quantum-challenges/challenges/quantum-woman-in-the-middle/index.ipynb" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/Sckathach/Sckathach.github.io/blob/main/404ctf/2024/quantum-challenges/challenges/quantum-woman-in-the-middle/index.ipynb" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/Sckathach/Sckathach.github.io/issues" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://sckathach.github.io">
<p>Home</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../../../../about.html">
<p>About</p>
</a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>